<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chart 7 (Venn Diagram) with Side Note</title>
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<style>
  body {
    margin: 0;
    background: #e6ebeb;
    font-family: Georgia, "Times New Roman", serif;
    color: #111;
  }

  /* 容器：左图右注释并列 */
  .container {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    gap: 40px;
    margin: 40px auto;
    max-width: 1200px;
    padding: 0 30px;
  }

  svg {
    background: #fff;
    box-shadow: 0 2px 10px rgba(0,0,0,0.06);
    border-radius: 10px;
  }

  /* 注释框样式 */
  .note-box {
    width: 340px;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    padding: 26px 30px;
    line-height: 1.6;
  }

  .note-box h2 {
    font-size: 22px;
    font-weight: 700;
    margin-top: 0;
    margin-bottom: 12px;
  }

  .note-box p {
    margin: 10px 0;
    font-size: 16px;
  }

  @media (max-width: 900px) {
    .container {
      flex-direction: column;
      align-items: center;
    }
    .note-box {
      width: 90%;
    }
  }
</style>
</head>
<body>

<div class="container">
  <!-- 左边是图表 -->
  <svg id="chart" width="640" height="400"></svg>

  <!-- 右边是注释 -->
  <div class="note-box">
    <h2>How I generated this chart</h2>
    <p>I first uploaded my teacher’s reference image and asked ChatGPT to recreate it in D3.js.</p>
    <p>The first version missed two lines, so I told ChatGPT to add them to complete the parallelogram.</p>
    <p>Then I added arrows, smooth animation, and hover highlights to make the lines draw naturally.</p>
    <p>Finally, I added tooltips and toggle effects, so the chart became interactive and neat.</p>
  </div>
</div>

<script>
/* === 你的 Venn 图表 === */
const svg = d3.select("#chart");
const W = +svg.attr("width"), H = +svg.attr("height");

const circles = [
  {id:"Delete",  key:"A", cx:250, cy:220, r:100, color:"rgba(160,140,220,0.45)"},
  {id:"Replace", key:"B", cx:330, cy:140, r:100, color:"rgba(150,130,130,0.45)"},
  {id:"Rewrite", key:"C", cx:410, cy:220, r:100, color:"rgba(240,220,120,0.45)"}
];

function regionLabel(inA,inB,inC){
  if(inA && inB && inC) return "VII";
  if(inA && inB && !inC) return "IV";
  if(!inA && inB && inC) return "V";
  if(inA && !inB && inC) return "VI";
  if(inA && !inB && !inC) return "I";
  if(!inA && inB && !inC) return "II";
  if(!inA && !inB && inC) return "III";
  return "";
}

const g = svg.append("g");
g.selectAll("circle").data(circles).enter().append("circle")
  .attr("cx",d=>d.cx).attr("cy",d=>d.cy)
  .attr("r",0)
  .style("fill",d=>d.color)
  .transition().duration(900).delay((_,i)=>i*120)
  .attr("r",d=>d.r);

const labelsPos = [
  {txt:"Delete",  x:circles[0].cx-100, y:circles[0].cy+120},
  {txt:"Replace", x:circles[1].cx,     y:circles[1].cy-120},
  {txt:"Rewrite", x:circles[2].cx+100, y:circles[2].cy+120},
];
g.selectAll(".label").data(labelsPos).enter().append("text")
  .attr("class","label").attr("x",d=>d.x).attr("y",d=>d.y)
  .style("opacity",0).text(d=>d.txt)
  .transition().duration(600).delay(550).style("opacity",1);

const roman = [
  {text:"I",   x:200, y:240},
  {text:"II",  x:330, y:100},
  {text:"III", x:440, y:240},
  {text:"IV",  x:270, y:180},
  {text:"V",   x:370, y:180},
  {text:"VII", x:330, y:200},
  {text:"VI",  x:340, y:250}
];
g.selectAll(".fixed").data(roman).enter().append("text")
  .attr("class","fixed").attr("x",d=>d.x).attr("y",d=>d.y)
  .style("opacity",0).text(d=>d.text)
  .transition().duration(600).delay(650).style("opacity",1);

const tooltip = d3.select("body").append("div")
  .style("position","absolute").style("background","#fff")
  .style("border","1px solid #ccc").style("border-radius","6px")
  .style("padding","6px 8px").style("font-size","12px")
  .style("pointer-events","none").style("box-shadow","0 2px 6px rgba(0,0,0,.1)")
  .style("opacity",0);

let locked = false;
function inside(d,x,y){const dx=x-d.cx,dy=y-d.cy;return dx*dx+dy*dy<=d.r*d.r;}
function highlightAt(x,y){
  const inA=inside(circles[0],x,y),inB=inside(circles[1],x,y),inC=inside(circles[2],x,y);
  const label=regionLabel(inA,inB,inC);
  svg.selectAll("circle").style("opacity",d=>{
    const flag=(d.key==="A"&&inA)||(d.key==="B"&&inB)||(d.key==="C"&&inC);
    return label?(flag?1.0:0.25):1.0;
  });
  if(label){
    const sets=[inA?"Delete":null,inB?"Replace":null,inC?"Rewrite":null].filter(Boolean).join(" ∩ ");
    tooltip.style("opacity",1).html(`<b>Region ${label}</b><br>${sets}`)
      .style("left",(x+14)+"px").style("top",(y+14)+"px");
  }else tooltip.style("opacity",0);
}
svg.on("mousemove",ev=>{if(locked)return;const pt=d3.pointer(ev,svg.node());highlightAt(pt[0],pt[1]);});
svg.on("mouseleave",()=>{if(!locked){svg.selectAll("circle").style("opacity",1);tooltip.style("opacity",0);}});
svg.on("click",ev=>{
  const pt=d3.pointer(ev,svg.node());
  if(!locked){highlightAt(pt[0],pt[1]);locked=true;}
  else{locked=false;svg.selectAll("circle").style("opacity",1);tooltip.style("opacity",0);}
});
</script>
</body>
</html>
